<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../paper-input/paper-input.html">
<link rel="import" href="../../paper-button/paper-button.html">

<link rel="import" href="../wp-rest.html">
<link rel="import" href="../wp-rest-resource.html">
<link rel="import" href="../wp-rest-document.html">
<!--<link rel="import" href="../wp-rest-api.html">-->
<!--<link rel="import" href="../wp-rest-api-collection.html">-->
<!--<link rel="import" href="../wp-rest-api-document.html">-->



<dom-module id="wp-rest-api-demo">
  <template>
    <style>
      :host {
        font-family: sans-serif;
      };
      .post{
        display:block;
        border-bottom:1px solid red;
      }
      .error{
        display:block;
        background:red;
        color:#fff;
        padding:1em;
      }
    </style>
  
    
    
    <wp-rest auto-discover host="https://edb.akr.club/wp-json"  namespace="wp/v2" auth-key="edb" auth-secret="Golgo.13.edb" api="{{WPRest}}"></wp-rest>
    <wp-rest-resource auto-list error="{{lastError}}" id="currentResource" api="[[WPRest]]" resource="[[currentResource]]" results="{{currentResourceResults}}"></wp-rest-resource>
    <wp-rest-document auto-read error="{{lastError}}" api="[[WPRest]]" resource="[[currentResource]]" param="[[currentDocumentId]]" result="{{currentDocument}}"></wp-rest-document>

    <p hidden$=[[!lastError]] class="error">{{lastError.message}}</p>
    
      
    <paper-button on-click="createDocument">create</paper-button>
    <template is="dom-repeat" items="[[currentResourceResults]]" as="post">
      <div class="post">
        <p>{{post.id}}</p>
        <p>{{post.title.rendered}}</p>
        <p>{{log(post)}}</p>
        <paper-button on-click="editDocument">edit</paper-button>
      </div>
    </template>
    <template is="dom-if" if="{{currentDocument}}">
    <div>
      <h1>#<span>{{currentDocument.id}}</span>{{currentDocument.title.rendered}}</h1>
      <p>Teh Document!</p>
    </div>
    </template>
    
  </template>
  
  <script>
    Polymer({
      is: "wp-rest-api-demo",
      properties: {
        currentResource: {
          type: String,
          notify: true
        },
        currentResourceResults: {
          type: Array,
          value: function(){
            return [];
          },
          notify: true
        },
        currentDocumentId: {
          type: String,
          notify: true
        },
        currentDocument: {
          type: Object,
          notify: true
        },
        lastError: {
                     type: Object,
                     notify: true
                   },
      },
      log: function(d){
        console.log('log:', d);
        return '';
      },
      editDocument: function( event ){
        var model = event.model;
        var post  = model.post;
        console.log('currentDocumentId', post.id );
        this.set('currentDocumentId', post.id );
        
      },
      createDocument: function( event ){
        // this.$.currentResource.create( { } ).then( function( created ){
        //   this.set('currentDocumentId', created.id );
        // }.bind(this))
        this.$.currentResource.explain().then( function( o ){
          console.log('explanation', o )
        });
      },
      
      saveEditedDocument: function(){
        
      },
      ready: function(){
        var it = this;
        this.currentResource='posts';
      }
      
    });
  </script>
</dom-module>